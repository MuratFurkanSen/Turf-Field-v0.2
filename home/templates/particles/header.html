{% load static %}
<header>
    <div class="header-container">
        <div class="logo">
            <a href="/">
                <img src="{% static 'images/logo.png' %}" alt="Logo">
            </a>
        </div>
        <nav class="nav-menu">
            <ul>
                <li><a href="">Kartım</a></li>
                <li><a href="#" id="teamsBtn">Takımlar</a></li>
                <li><a href="/field/">Sahalar</a></li>
                <li><a href="/reservation/">Rezervasyonlarım</a></li>
            </ul>
        </nav>
        <div class="login-button">
            {% if user.is_authenticated %}
                <div class="user-dropdown">
                    <button class="user-dropdown-btn">
                        <i class="fas fa-user-circle"></i>
                        {{ user.username }}
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="user-dropdown-content">
                        <a href="/user/profile"><i class="fas fa-user"></i> Profilim</a>
                        <a href="/user/settings"><i class="fas fa-cog"></i> Ayarlar</a>
                        <a href="/user/logout"><i class="fas fa-sign-out-alt"></i> Çıkış Yap</a>
                    </div>
                </div>
            {% else %}
                <button id="loginBtn">Giriş Yap/Kayıt Ol</button>
            {% endif %}
        </div>
    </div>
</header>

<!-- Teams Popup -->
<div id="teamsPopup" class="popup">
    <div class="popup-content">
        <span class="close-popup">&times;</span>
        
        <div class="teams-tabs">
            <button class="tab-btn active" data-tab="create">Takım Oluştur</button>
            <button class="tab-btn" data-tab="teams">Takımlarım</button>
        </div>

        <div class="tab-content" id="create-tab">
            <div class="create-team-form">
                <input type="text" id="teamName" placeholder="Takım Adı" class="team-input">
                <button class="create-team-btn">Takımı Oluştur</button>
            </div>
        </div>

        <div class="tab-content" id="teams-tab" style="display: none;">
            <div class="teams-container">
                <div class="teams-slider">
                    <div class="teams-list">
                        <!-- Takım kartları buraya dinamik olarak eklenecek -->
                    </div>
                    <button class="slider-btn prev-btn">&lt;</button>
                    <button class="slider-btn next-btn">&gt;</button>
                </div>
                <div class="slider-pagination">
                    <!-- Noktalar buraya dinamik olarak eklenecek -->
                </div>
                <div class="no-teams-message" style="display: none;">
                    <p>Henüz Takım Oluşturmadınız</p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.popup {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(5px);
    z-index: 1000;
    animation: fadeIn 0.3s ease;
}

.popup-content {
    position: relative;
    background: linear-gradient(145deg, #ffffff, #f8f9fa);
    margin: 0;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 40px;
    width: 95%;
    max-width: 1200px;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    max-height: 90vh;
    overflow-y: auto;
    animation: slideIn 0.4s ease;
}

.close-popup {
    position: absolute;
    right: 20px;
    top: 10px;
    font-size: 24px;
    cursor: pointer;
    color: #666;
}

.close-popup:hover {
    color: #000;
}

.create-team-section, .my-teams-section {
    margin-bottom: 30px;
}

.create-team-section h2, .my-teams-section h2 {
    color: #333;
    margin-bottom: 15px;
    font-size: 1.5em;
}

.create-team-form {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    height: 300px;
    background: linear-gradient(145deg, #ffffff, #f8f9fa);
    border-radius: 16px;
    padding: 30px;
    align-items: center;
}

.team-input {
    flex: 1;
    padding: 12px 20px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 16px;
    transition: all 0.3s ease;
    background: white;
}

.team-input:focus {
    border-color: #4CAF50;
    box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
    outline: none;
}

.create-team-btn {
    padding: 12px 25px;
    background: linear-gradient(145deg, #4CAF50, #45a049);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 500;
    transition: all 0.3s ease;
}

.create-team-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
}

.teams-container {
    width: 100%;
    overflow: hidden;
    position: relative;
    padding: 20px 20px;
}

.teams-slider {
    position: relative;
    width: 100%;
    max-width: 1000px;
    margin: 0 auto;
    overflow: hidden;
}

.teams-list {
    display: flex;
    gap: 5px;
    transition: transform 0.3s ease;
    padding: 10px 0;
    padding-left: 0;
    margin-left: 0;
}

.team-card {
    flex: 0 0 1000px;
    background: linear-gradient(145deg, #ffffff, #f8f9fa);
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    padding: 30px;
    height: 300px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.team-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 25px rgba(0,0,0,0.15);
}

.team-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.team-name {
    font-size: 24px;
    font-weight: bold;
    color: #333;
}

.team-members {
    display: flex;
    gap: 20px;
    margin-top: 15px;
    padding: 15px;
    background: #f8f8f8;
    border-radius: 8px;
}

.member-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
}

.member-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #4CAF50;
}

.member-name {
    font-size: 14px;
    color: #666;
    text-align: center;
    max-width: 80px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.team-actions {
    display: flex;
    gap: 15px;
}

.team-action-btn {
    background: none;
    border: none;
    cursor: pointer;
    color: #666;
    font-size: 20px;
    transition: color 0.3s;
}

.team-action-btn:hover {
    color: #333;
}

.team-info {
    margin-top: 20px;
    color: #666;
    font-size: 16px;
    line-height: 1.6;
}

.slider-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 50px;
    height: 50px;
    background: white;
    border: none;
    border-radius: 50%;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    cursor: pointer;
    z-index: 10;
    font-size: 24px;
    color: #4CAF50;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.slider-btn:hover {
    background: #4CAF50;
    color: white;
}

.prev-btn {
    left: 5px;
}

.next-btn {
    right: 5px;
}

.no-teams-message {
    text-align: center;
    padding: 30px;
    color: #666;
    font-size: 16px;
    height: 300px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(145deg, #ffffff, #f8f9fa);
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.no-teams-message:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 25px rgba(0,0,0,0.15);
}

.slider-pagination {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-top: 20px;
}

.pagination-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: #ddd;
    cursor: pointer;
    transition: all 0.3s ease;
}

.pagination-dot.active {
    background-color: #4CAF50;
    transform: scale(1.2);
}

.teams-tabs {
    display: flex;
    gap: 20px;
    margin-bottom: 30px;
    border-bottom: 2px solid #e0e0e0;
    padding-bottom: 15px;
}

.tab-btn {
    padding: 12px 25px;
    background: none;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 500;
    color: #666;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.tab-btn::after {
    content: '';
    position: absolute;
    bottom: -17px;
    left: 0;
    width: 100%;
    height: 3px;
    background: linear-gradient(90deg, #4CAF50, #45a049);
    border-radius: 2px;
    transform: scaleX(0);
    transition: transform 0.3s ease;
}

.tab-btn.active {
    color: #4CAF50;
    background: rgba(76, 175, 80, 0.1);
}

.tab-btn.active::after {
    transform: scaleX(1);
}

.tab-btn:hover {
    color: #4CAF50;
    background: rgba(76, 175, 80, 0.05);
}

.tab-content {
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideIn {
    from { 
        opacity: 0;
        transform: translate(-50%, -45%);
    }
    to { 
        opacity: 1;
        transform: translate(-50%, -50%);
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const teamsBtn = document.getElementById('teamsBtn');
    const teamsPopup = document.getElementById('teamsPopup');
    const closePopup = document.querySelector('.close-popup');
    const createTeamBtn = document.querySelector('.create-team-btn');
    const teamNameInput = document.getElementById('teamName');
    const teamsList = document.querySelector('.teams-list');
    const prevBtn = document.querySelector('.prev-btn');
    const nextBtn = document.querySelector('.next-btn');
    const noTeamsMessage = document.querySelector('.no-teams-message');
    const teamsSlider = document.querySelector('.teams-slider');
    const paginationContainer = document.querySelector('.slider-pagination');

    let currentPosition = 0;
    const cardWidth = 1005; // card width + gap (1000px + 5px)
    const cardsPerView = 1; // Tek kart gösterimi için 1 yaptım
    let currentSlide = 0;

    function createPaginationDots() {
        paginationContainer.innerHTML = '';
        const totalSlides = Math.ceil(teamsList.children.length / cardsPerView);
        
        for (let i = 0; i < totalSlides; i++) {
            const dot = document.createElement('div');
            dot.className = 'pagination-dot' + (i === currentSlide ? ' active' : '');
            dot.addEventListener('click', () => {
                goToSlide(i);
            });
            paginationContainer.appendChild(dot);
        }
    }

    function goToSlide(slideIndex) {
        currentSlide = slideIndex;
        currentPosition = slideIndex * cardWidth * cardsPerView;
        teamsList.style.transform = `translateX(-${currentPosition}px)`;
        updatePaginationDots();
        updateSliderButtons();
    }

    function updatePaginationDots() {
        const dots = paginationContainer.querySelectorAll('.pagination-dot');
        dots.forEach((dot, index) => {
            dot.classList.toggle('active', index === currentSlide);
        });
    }

    function updateSliderButtons() {
        const totalSlides = Math.ceil(teamsList.children.length / cardsPerView);
        prevBtn.style.display = currentSlide > 0 ? 'flex' : 'none';
        nextBtn.style.display = currentSlide < totalSlides - 1 ? 'flex' : 'none';
    }

    function slide(direction) {
        const totalSlides = Math.ceil(teamsList.children.length / cardsPerView);
        
        if (direction === 'next' && currentSlide < totalSlides - 1) {
            currentSlide++;
        } else if (direction === 'prev' && currentSlide > 0) {
            currentSlide--;
        }
        
        goToSlide(currentSlide);
    }

    prevBtn.addEventListener('click', () => slide('prev'));
    nextBtn.addEventListener('click', () => slide('next'));

    function createTeamCard(teamName) {
        const teamCard = document.createElement('div');
        teamCard.className = 'team-card';
        teamCard.style.cursor = 'pointer';
        teamCard.addEventListener('click', () => {
            window.location.href = '/team/';
        });
        teamCard.innerHTML = `
            <div class="team-card-header">
                <span class="team-name">${teamName}</span>
                <div class="team-actions">
                    <button class="team-action-btn" title="Düzenle">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="team-action-btn" title="Sil">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            <div class="team-members">
                <div class="member-item">
                    <img src="{% static 'images/default-avatar.png' %}" alt="Üye" class="member-avatar">
                    <span class="member-name">Ahmet Yılmaz</span>
                </div>
                <div class="member-item">
                    <img src="{% static 'images/default-avatar.png' %}" alt="Üye" class="member-avatar">
                    <span class="member-name">Mehmet Demir</span>
                </div>
                <div class="member-item">
                    <img src="{% static 'images/default-avatar.png' %}" alt="Üye" class="member-avatar">
                    <span class="member-name">Ayşe Kaya</span>
                </div>
                <div class="member-item">
                    <img src="{% static 'images/default-avatar.png' %}" alt="Üye" class="member-avatar">
                    <span class="member-name">Fatma Şahin</span>
                </div>
            </div>
            <div class="team-info">
                <p>Oluşturulma: ${new Date().toLocaleDateString()}</p>
                <p>Üye Sayısı: 5</p>
            </div>
        `;
        return teamCard;
    }

    teamsBtn.addEventListener('click', function(e) {
        e.preventDefault();
        teamsPopup.style.display = 'block';
        updateTeamsDisplay();
    });

    closePopup.addEventListener('click', function() {
        teamsPopup.style.display = 'none';
    });

    window.addEventListener('click', function(e) {
        if (e.target === teamsPopup) {
            teamsPopup.style.display = 'none';
        }
    });

    createTeamBtn.addEventListener('click', function() {
        const teamName = teamNameInput.value.trim();
        if (teamName) {
            const teamCard = createTeamCard(teamName);
            teamsList.appendChild(teamCard);
            teamNameInput.value = '';
            updateTeamsDisplay();
            createPaginationDots();
        }
    });

    function updateTeamsDisplay() {
        const hasTeams = teamsList.children.length > 0;
        teamsSlider.style.display = hasTeams ? 'block' : 'none';
        noTeamsMessage.style.display = hasTeams ? 'none' : 'block';
        if (hasTeams) {
            currentSlide = 0; // Reset to first slide
            goToSlide(0);
            createPaginationDots();
        }
    }

    // Sayfa yüklendiğinde takım durumunu kontrol et
    updateTeamsDisplay();

    // Tab switching functionality
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');

    tabBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            // Remove active class from all buttons
            tabBtns.forEach(b => b.classList.remove('active'));
            // Add active class to clicked button
            btn.classList.add('active');

            // Hide all tab contents
            tabContents.forEach(content => content.style.display = 'none');
            // Show selected tab content
            const tabId = btn.getAttribute('data-tab') + '-tab';
            document.getElementById(tabId).style.display = 'block';
        });
    });
});
</script>