{% extends 'base.html' %}
{% load static %}
{% block extraCSS %}
    <link rel="stylesheet" href="{% static 'css/team/team_main.css' %}">
{% endblock %}
{% block content %}
    <div class="content">
        <div class="left-div">
            <h2>Takım</h2>
            <div id="layoutPreview"></div>
            <div class="edit-button" onclick="openPopup()">Düzenle</div>
        </div>
        <img src="{% static 'images/line.png' %}" alt="Line" class="divider-image">
        <div class="right-div">
            <div class="bekleyen-rezervasyonlar">
                <h2>Güncel Rezervasyonlar</h2>
            </div>
            <!--
            Could have open it later
            <div class="wallet-summary">
                <div class="wallet-title">Cüzdan</div>
                <div class="wallet-balance-row">
                    <span class="wallet-label">Mevcut Bakiye</span>
                    <span class="wallet-amount">{{ request.user.profile.wallet_balance }} TL</span>
                </div>
            </div>
            -->
            <div class="ana-div">
                {% for reservation, time_interval,date,exp_date in payment_reservation_data %}
                    {% if reservation.status == 'payment' %}
                        {% include 'particles/payment_reservation.html' %}
                    {% elif reservation.status == 'active' %}
                        {% include 'particles/active_reservation.html' %}
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="popup" id="editPopup">
        <div class="popup-content">
            <span class="close" onclick="closePopup()">&times;</span>
            <div class="popup-left">
                <div class="search-container">
                    <form id="playerSearchForm">
                        <img src="{% static 'images/search.png' %}" alt="Search">
                        <input type="text" name="username" placeholder="Kullanıcı Adı ile Oyuncu Ekle...">
                        <button type="submit">Ekle</button>
                    </form>
                </div>

                <div class="player-cards">
                    {% for player,position in player_position_zip %}
                        {% if position.top == "-1" or position.left == "-1" %}
                            <div class="player-card" draggable="true" data-id="{{ player.id }}">
                                <img src="{{ player.profile_picture.url }}" alt="playerPicture">
                                <p>{{ player.user.username }}</p>
                                <div class="color-buttons">
                                    <button onclick="changeColor(this, 'red')" class="color-button red"></button>
                                    <button onclick="changeColor(this, 'blue')" class="color-button blue"></button>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>

                {% if team_join_requests %}
                    <!-- Team Invites Section -->
                    <div class="team-invites-section">
                        <h4>Gelen Katılma İstekleri</h4>
                        <div class="received-invites">
                            {% for join_request in team_join_requests %}
                                <div class="invite-item">
                                    <div class="invite-info">
                                        <div class="invite-team-name">
                                            <i class="fas fa-users"></i>
                                            <span>{{ join_request.sender.name }}</span>
                                        </div>
                                        <div class="invite-meta">
                                    <span>
                                        <i class="fas fa-user-friends"></i>
                                        {{ join_request.team.members.count }} Oyuncu
                                    </span>
                                            <span>
                                        <i class="fas fa-crown"></i>
                                        {{ join_request.team.captain.user.username }}
                                    </span>
                                        </div>
                                    </div>
                                    <div class="invite-actions">
                                        <button class="accept-invite-btn" onclick="acceptJoinRequest(this)" data-request-id="{{ join_request.pk }}">
                                            <i class="fas fa-check"></i>
                                            Kabul Et
                                        </button>
                                        <button class="decline-invite-btn" onclick="rejectJoinRequest(this)" data-request-id="{{ join_request.pk }}">
                                            <i class="fas fa-times"></i>
                                            Reddet
                                        </button>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            </div>

            <div id="layout" class="popup-right" ondragover="allowDrop(event)" ondrop="drop(event)"
                 data-bg-image="{% static 'images/acikksaha.png' %}">
                {% for player,position in player_position_zip %}
                    {% if position.top != '-1' and position.left != '-1' %}
                        <div class="player-card" draggable="true" data-id="{{ player.id }}"
                             style="position: absolute; left: {{ position.left }}px; top: {{ position.top }}px;">
                            <img src="{{ player.profile_picture.url }}" alt="{{ player.user.username }}"
                                 style="border-color: {{ position.color|default:'red' }}">
                            <p>{{ player.user.username }}</p>
                            <div class="color-buttons">
                                <button onclick="changeColor(this, 'red')" class="color-button red"></button>
                                <button onclick="changeColor(this, 'blue')" class="color-button blue"></button>
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
            <div class="button-container">
                <button class="reset-button" onclick="resetPositions()">Sıfırla</button>
                <button class="save-button" onclick="savePositions()">Görüntüyü Kaydet</button>
            </div>
        </div>
    </div>
    {% csrf_token %}
{% endblock %}
{% block extraJS %}
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="{% static 'js/team/team_main.js' %}"></script>
{% endblock %}


